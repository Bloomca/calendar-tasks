define(["knockout","ViewModels/dayTasks","Tasks"],function(e,t,n){function a(e){var t=[],n=new Date(+e),a=n.getDay(),d=e.getMonth(),r=e.getFullYear()+"-"+d+"-";if(a){n.setDate(-(a-1));for(var l=n.getDate(),i=0;a>i;i++)t.push({num:l,date:n.getFullYear()+"-"+n.getMonth()+"-"+l++,anotherMonth:!0})}var o=new Date(e.getFullYear(),e.getMonth()+1,0);for(i=0;i<o.getDate();i++)t.push({num:i+1,date:r+(i+1)});var s=t.length%7,u=new Date(e.getFullYear(),e.getMonth()+1,1);for(i=0;s>i;i++)t.push({num:i+1,date:u.getFullYear()+"-"+u.getMonth()+"-"+(i+1),anotherMonth:!0});return t}var d="SUN MON TUES WEN THU FRI SAT".split(" ");e.bindingHandlers.calendarGrid={init:function(r,l){function i(l){var i=l,o=new Date(i.year,i.month);r.innerHTML="";for(var s=document.createElement("tbody"),u=document.createElement("tr"),c=0;7>c;c++){var h=document.createElement("td");h.classList.add("top"),h.appendChild(document.createTextNode(d[c])),u.appendChild(h)}s.appendChild(u);var m=0,g=a(o),v=g.length/7;for(c=0;v>c;c++){var p=document.createElement("tr"),f=7*m++,M=g.slice(f,f+7);M.forEach(function(a,d){var r=document.createElement("td");r.setAttribute("data-bind","click: showFull"),r.id=Math.random(),a.anotherMonth&&r.classList.add("another-month"),r.innerHTML='<div class="date-num">'+a.num+'</div><div class="events-number" data-bind="text: eventsNumber, visible: tasks().length > 3"></div><ul data-bind="foreach: tasks"><li class="item"><div data-bind="text: title"></div></li></ul>',p.appendChild(r),e.applyBindings(new t(n[a.date],a.date,d,m),r)}),s.appendChild(p)}r.appendChild(s)}l().subscribe(function(e){console.log("update called"),i(e)});var o=new Date;i({year:o.getFullYear(),month:o.getMonth()})}}});